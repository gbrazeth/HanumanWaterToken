# ğŸ”’ Plano de AÃ§Ã£o - Vulnerabilidades

**Data**: 13 de Novembro de 2025  
**Status Atual**: ğŸŸ¡ **50 vulnerabilidades** (48 low, 2 high)

---

## ğŸ“Š AnÃ¡lise Detalhada

### ğŸ”´ **Vulnerabilidades ALTAS (2)**

#### 1. @walletconnect/logger - Prototype Pollution
- **Severidade**: Alta
- **CVE**: NÃ£o especificado
- **Pacotes afetados**: 
  - `@walletconnect/core`
  - `@walletconnect/types`
  - `@walletconnect/utils`
  - `@walletconnect/sign-client`
  - `@walletconnect/universal-provider`
  - `@web3modal/*` (todo ecossistema)
  - `@reown/appkit*` (todo ecossistema)
- **Status**: âŒ **Sem fix disponÃ­vel**
- **RazÃ£o**: DependÃªncia transitiva profunda
- **Risco Real**: ğŸŸ¡ MÃ©dio (difÃ­cil explorar em produÃ§Ã£o)

#### 2. tmp - Symbolic Link Attack
- **Severidade**: Baixa (mas marcada como alta pelo npm)
- **CVE**: GHSA-52f5-9888-hmc6
- **Pacotes afetados**:
  - `external-editor`
  - `@changesets/cli`
  - `patch-package`
- **Status**: âš ï¸ **Fix disponÃ­vel com breaking changes**
- **Risco Real**: ğŸŸ¢ Muito Baixo (apenas dev dependencies)

---

## ğŸ¯ EstratÃ©gia de ResoluÃ§Ã£o

### âœ… **Fase 1: AtualizaÃ§Ãµes Seguras (AGORA)**

#### 1.1 Atualizar DependÃªncias Menores
```bash
# Atualizar pacotes sem breaking changes
npm update
```

**BenefÃ­cios**:
- Atualiza patches de seguranÃ§a
- Sem risco de quebrar cÃ³digo
- Pode resolver algumas vulnerabilidades baixas

#### 1.2 Atualizar React e React-DOM
```bash
npm install react@19.2.0 react-dom@19.2.0
```

**BenefÃ­cios**:
- VersÃ£o mais recente
- Melhor performance
- Patches de seguranÃ§a

---

### âš ï¸ **Fase 2: AtualizaÃ§Ãµes com Testes (ESTA SEMANA)**

#### 2.1 Atualizar Radix UI (todos os pacotes)
```bash
npm install @radix-ui/react-accordion@latest \
  @radix-ui/react-alert-dialog@latest \
  @radix-ui/react-aspect-ratio@latest \
  @radix-ui/react-avatar@latest \
  @radix-ui/react-checkbox@latest \
  @radix-ui/react-collapsible@latest \
  @radix-ui/react-context-menu@latest \
  @radix-ui/react-dialog@latest \
  @radix-ui/react-dropdown-menu@latest \
  @radix-ui/react-hover-card@latest \
  @radix-ui/react-label@latest \
  @radix-ui/react-menubar@latest \
  @radix-ui/react-navigation-menu@latest \
  @radix-ui/react-popover@latest \
  @radix-ui/react-progress@latest \
  @radix-ui/react-radio-group@latest \
  @radix-ui/react-scroll-area@latest \
  @radix-ui/react-select@latest \
  @radix-ui/react-separator@latest \
  @radix-ui/react-slider@latest \
  @radix-ui/react-slot@latest \
  @radix-ui/react-switch@latest \
  @radix-ui/react-tabs@latest \
  @radix-ui/react-toast@latest \
  @radix-ui/react-toggle@latest \
  @radix-ui/react-toggle-group@latest \
  @radix-ui/react-tooltip@latest
```

**BenefÃ­cios**:
- Componentes UI atualizados
- Melhor acessibilidade
- Patches de seguranÃ§a

**Riscos**:
- PossÃ­veis mudanÃ§as de API
- Testar UI apÃ³s atualizaÃ§Ã£o

#### 2.2 Atualizar next-intl
```bash
npm install next-intl@4.5.2
```

#### 2.3 Atualizar react-hook-form
```bash
npm install react-hook-form@7.66.0
```

#### 2.4 Atualizar resend
```bash
npm install resend@6.4.2
```

---

### ğŸ”„ **Fase 3: AtualizaÃ§Ãµes com Breaking Changes (AVALIAR)**

#### 3.1 Hardhat 3.x
```bash
npm install hardhat@3.0.14 --save-dev
```

**Breaking Changes**:
- API changes
- Plugin compatibility
- Precisa revisar scripts

**DecisÃ£o**: â³ **Avaliar necessidade**
- Hardhat sÃ³ Ã© usado em dev
- NÃ£o afeta produÃ§Ã£o
- Pode esperar

#### 3.2 Ethers 6.x
```bash
npm install ethers@6.15.0
```

**Breaking Changes**:
- API completamente diferente
- Precisa refatorar TODO o cÃ³digo Web3
- Muito trabalho

**DecisÃ£o**: âŒ **NÃƒO FAZER AGORA**
- Alto risco
- Muito trabalho
- Funciona bem com v5

#### 3.3 TailwindCSS 4.x
```bash
npm install tailwindcss@4.1.17
```

**Breaking Changes**:
- Nova engine
- ConfiguraÃ§Ã£o diferente
- Pode quebrar estilos

**DecisÃ£o**: â³ **Avaliar depois**
- NÃ£o urgente
- Testar em branch separado

---

### ğŸ—‘ï¸ **Fase 4: Remover DependÃªncias NÃ£o Usadas (HOJE)**

#### 4.1 Verificar Uso
```bash
# Verificar se esses pacotes sÃ£o realmente usados
grep -r "@changesets/cli" .
grep -r "patch-package" .
```

#### 4.2 Remover se NÃ£o Usado
```bash
npm uninstall @changesets/cli
npm uninstall patch-package
```

**BenefÃ­cios**:
- Remove vulnerabilidades do `tmp`
- Reduz tamanho do node_modules
- Menos dependÃªncias para manter

---

### ğŸ” **Fase 5: Monitorar WalletConnect (CONTÃNUO)**

#### 5.1 Verificar Updates Diariamente
- GitHub: https://github.com/WalletConnect/walletconnect-monorepo
- npm: `npm outdated @walletconnect/*`

#### 5.2 Quando Houver Fix
```bash
npm update @walletconnect/logger
npm update @web3modal/wagmi
npm update @reown/appkit
```

---

## ğŸ“‹ Checklist de ExecuÃ§Ã£o

### Hoje (30 min)
- [ ] Executar `npm update`
- [ ] Atualizar React 19.2.0
- [ ] Verificar uso de @changesets/cli
- [ ] Verificar uso de patch-package
- [ ] Remover pacotes nÃ£o usados
- [ ] Testar build
- [ ] Testar aplicaÃ§Ã£o
- [ ] Commit e push

### Esta Semana
- [ ] Atualizar Radix UI
- [ ] Atualizar next-intl
- [ ] Atualizar react-hook-form
- [ ] Atualizar resend
- [ ] Testar todas as funcionalidades
- [ ] Deploy e verificaÃ§Ã£o

### Este MÃªs
- [ ] Monitorar WalletConnect updates
- [ ] Avaliar Hardhat 3.x
- [ ] Avaliar TailwindCSS 4.x
- [ ] Configurar Dependabot auto-merge

---

## ğŸš€ Comandos para Executar AGORA

### Passo 1: Backup
```bash
cd /Users/gabrielbraz/HanumanWaterToken/hwt-landing
cp package.json package.json.backup2
cp package-lock.json package-lock.json.backup2
```

### Passo 2: Atualizar Pacotes Seguros
```bash
# Atualizar patches
npm update

# Atualizar React
npm install react@19.2.0 react-dom@19.2.0
```

### Passo 3: Verificar DependÃªncias NÃ£o Usadas
```bash
# Buscar uso de @changesets/cli
grep -r "@changesets" . --exclude-dir=node_modules

# Buscar uso de patch-package
grep -r "patch-package" . --exclude-dir=node_modules
```

### Passo 4: Remover se NÃ£o Usado
```bash
# Se nÃ£o encontrar uso, remover
npm uninstall @changesets/cli
npm uninstall patch-package
```

### Passo 5: Testar
```bash
npm run build
npm run dev
```

### Passo 6: Verificar Melhorias
```bash
npm audit
```

### Passo 7: Commit
```bash
git add package.json package-lock.json
git commit -m "security: atualizar dependÃªncias e remover pacotes nÃ£o usados

- Atualizar React para 19.2.0
- Executar npm update para patches
- Remover @changesets/cli (nÃ£o usado)
- Remover patch-package (nÃ£o usado)
- Reduzir vulnerabilidades"

git push origin main
```

---

## ğŸ“Š Impacto Esperado

### Antes
- **50 vulnerabilidades** (48 low, 2 high)
- **1509 pacotes**

### Depois (Estimativa)
- **~30-35 vulnerabilidades** (reduÃ§Ã£o de 30-40%)
- **~1450 pacotes** (menos dependÃªncias)
- **0 vulnerabilidades mÃ©dias** âœ…
- **2 vulnerabilidades altas** (WalletConnect - aguardando fix)

---

## âš ï¸ Vulnerabilidades que NÃƒO Podemos Resolver Agora

### 1. @walletconnect/logger (Alta)
**Por quÃª?**
- DependÃªncia transitiva profunda
- Sem fix disponÃ­vel dos mantenedores
- Afeta todo ecossistema Web3Modal/WalletConnect

**MitigaÃ§Ã£o**:
- Monitorar updates
- NÃ£o expor inputs nÃ£o sanitizados
- Risco real Ã© baixo em produÃ§Ã£o

### 2. tmp (Baixa, mas marcada como alta)
**Por quÃª?**
- Apenas dev dependencies
- NÃ£o afeta produÃ§Ã£o
- Fix requer breaking changes

**MitigaÃ§Ã£o**:
- Remover pacotes que dependem dela
- NÃ£o crÃ­tico para produÃ§Ã£o

---

## ğŸ¯ Meta Final

**Objetivo**: Reduzir para **~30 vulnerabilidades** (todas baixas, exceto 2 do WalletConnect)

**Status Esperado**: ğŸŸ¢ **BOM**
- Todas vulnerabilidades crÃ­ticas resolvidas
- Apenas vulnerabilidades baixas e 2 altas (aguardando mantenedores)
- CÃ³digo atualizado e funcionando

---

## ğŸ“ Recursos

- [npm audit docs](https://docs.npmjs.com/cli/v8/commands/npm-audit)
- [WalletConnect GitHub](https://github.com/WalletConnect/walletconnect-monorepo)
- [Dependabot](https://github.com/gbrazeth/HanumanWaterToken/security/dependabot)

---

**PrÃ³xima AtualizaÃ§Ã£o**: ApÃ³s executar Fase 1  
**ResponsÃ¡vel**: Equipe de Desenvolvimento
